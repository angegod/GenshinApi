(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{112:(e,a,r)=>{Promise.resolve().then(r.bind(r,4759))},4759:(e,a,r)=>{"use strict";r.d(a,{default:()=>b});var t=r(5155),s=r(2115),l=r(8326),i=r(2039),n=r(3142);r(1209);var c=r(3464),d=r(5424),o=r(5695),x=r(9988),m=r(6719),h=r(5504),u=r(39),f=r(2197),p=r(9779),v=r(4422),j=r(9194),w=r(7525);let N=function(){return(0,t.jsxs)("div",{className:"w-[300px] flex flex-col max-[600px]:my-3",children:[(0,t.jsx)("h2",{className:"text-red-600 font-bold text-lg",children:"使用說明"}),(0,t.jsxs)("ul",{className:"[&>li]:text-stone-400 list-decimal [&>li]:ml-2 max-[400px]:[&>li]:text-sm",children:[(0,t.jsx)("li",{children:"此工具會根據玩家放在展示框的12個腳色身上的聖遺物做數據分析"}),(0,t.jsx)("li",{children:"翻盤機率是指該聖遺物透過啟示之塵後分數變高的機率為何"}),(0,t.jsx)("li",{children:"目前該工具只支援計算五星強化至滿等聖遺物"}),(0,t.jsx)("li",{children:"此工具相關數據或算法仍有更改的可能，敬請見諒!"}),(0,t.jsx)("li",{children:"如果發現服務頻繁發生錯誤，可以先暫時使用simulator。"}),(0,t.jsxs)("li",{children:["更詳細的操作說明可以參考",(0,t.jsx)("a",{href:"https://home.gamer.com.tw/artwork.php?sn=6065608",className:"!underline",children:"這篇"})]})]})]})};var g=r(8993);let b=function(){let e=(0,s.useRef)(""),[a,b]=(0,s.useState)(void 0),[I,S]=(0,s.useState)(),[y,D]=(0,s.useState)(0),[k,A]=(0,s.useState)(2),R=(0,s.useRef)(2),[C,E]=(0,s.useState)(void 0),[H,O]=(0,s.useState)(void 0),[P,_]=(0,s.useState)({label:void 0,tag:void 0,color:void 0,value:void 0}),[J,F]=(0,s.useState)(void 0),[M,B]=(0,s.useState)(3),[T,L]=(0,s.useState)([]),q=(0,s.useRef)(null),{showStatus:U,updateStatus:G,hideStatus:V}=(0,v.Z)(),z="GenshinImporterData",{setHistory:Q,getHistory:W,addHistory:Y,deleteHistory:Z,resetHistory:$,limitHistory:K}=(0,j.A)(),[X,ee]=(0,s.useState)(!1),[ea,er]=(0,s.useState)([]),et=(0,s.useRef)([]),es=(0,o.usePathname)(),[el,ei]=(0,s.useState)(!0),[en,ec]=(0,s.useState)(!1),ed=[{rank:"S+",stand:85,color:"rgb(239, 68, 68)",tag:"S+"},{rank:"S",stand:70,color:"rgb(239, 68, 68)",tag:"S"},{rank:"A",stand:50,color:"rgb(234, 179, 8)",tag:"A"},{rank:"B",stand:35,color:"rgb(234, 88 , 12)",tag:"B"},{rank:"C",stand:15,color:"rgb(163, 230, 53)",tag:"C"},{rank:"D",stand:0,color:"rgb(22,163,74)",tag:"D"}];async function eo(r){let{sendData:t,standard:s,sendlimit:l}=r,i="http://localhost:3000"===window.location.origin?"http://localhost:5000/artifact/get":"https://expressapi-o9du.onrender.com/artifact/get",n=0;if(!t){if(!/^\d+$/.test(e.current)||!e.current)return void G("請輸入有效的UID!!","error");if(!a)return void G("未選擇任何腳色!!","error");if(!ea||0===ea.length)return void G("至少選擇一項加權!!","error");if(ea.filter(e=>{var a;return(null!=(a=e.SelectPriority)?a:0)>0}).length<2)return void G("優先指定詞條至少需要兩個!","error");if(k>4||k<2)return void G("保底次數只能為2,3或4次!","error");t={uid:e.current,charID:a}}s||(s=[...null!=ea?ea:[]]),n=l||k,ec(!1),U("正在尋找匹配資料......","process"),ei(!1),E(void 0),_({label:void 0,tag:void 0,color:void 0,value:void 0}),F(void 0),O(void 0),L([]),S(void 0),await c.A.post(i,t,{headers:{"Content-Type":"application/json"}}).then(async e=>{switch(e.data){case 800:G("找不到該腳色。必須要將腳色放在展示區才可以抓到資料!!","error"),ei(!0);break;case 801:G("找不到該部件的聖遺物，如果是剛剛才更新的話建議等五分鐘再使用一次!!","error"),ei(!0);break;case 802:G("該聖遺物等級尚未強化至滿等，請先強化至滿等後再嘗試!","error"),ei(!0);break;case 803:G("該聖遺物非五星遺器，請選擇部位為五星強化滿等之聖遺物","error"),ei(!0);break;case 804:G("該腳色並未穿著五星聖遺物！！","error"),ei(!0);break;case 810:G("溝通次數太過於頻繁 請稍後再試!!","error"),ei(!0);break;case 900:G("系統正在維護\n請稍後再試!","error"),ei(!0);break;default:await ex(e.data,s,n)}}).catch(e=>{e.response&&429===e.response.status?G("請求次數過於頻繁\n請稍後再試!!","error"):G("系統正在維護中\n請稍後再試!!","error"),ei(!0)})}async function ex(e,t,s){let l=[];for(let d of e){let e={};for(var c=3;c<=4;c++){let l=await function(e,t,s,l){return new Promise(c=>{let d=new Worker(r.tu(new URL(r.p+r.u(682),r.b))),o=i.A.find(a=>a.fieldName===e.flat.reliquaryMainstat.mainPropId),x=[];e.flat.reliquarySubstats.forEach((e,a)=>{let r=i.A.find(a=>a.fieldName===e.appendPropId),t=e.statValue,s={index:a,subaffix:r.name,data:t};x.push(s)});let m={charID:a,MainData:o.name,SubData:x,partsIndex:n.A[e.flat.equipType],standard:t,limit:l,enchanceCount:s};U("數據計算處理中......","process"),d.postMessage(m),d.onmessage=function(a){c({relic:e,ExpRate:a.data.expRate,Rscore:a.data.relicscore,PieNums:a.data.returnData,Rank:a.data.relicrank,standDetails:t})}})}(d,t,c+1,s);e[c]=l}l.push(e)}0===l.length?(G("該腳色身上的聖遺物不符合重洗條件!!","default"),ei(!0)):G("資料顯示完畢","success"),L(l),q.current=l,R.current=s,ec(!0)}(0,s.useEffect)(()=>{!function(){ee(!1),A(2),$();let e=localStorage.getItem(z),a=e?JSON.parse(e):null;if(console.log(a),null===a){Q([]),ee(!0),G("尚未有任何操作紀錄","default");return}U("正在載入過往紀錄中......","process"),a=a.filter(e=>"1.5"===e.version),localStorage.setItem(z,JSON.stringify(a)),null!=a&&a.length>0?(Q(a),G("先前紀錄已匯入!!","success")):G("尚未有任何操作紀錄","default"),ee(!0)}()},[es]),(0,s.useEffect)(()=>{0!==T.length&&(S(T[y][M].relic),E(T[y][M].ExpRate),O(T[y][M].Rscore),F(T[y][M].PieNums),_(T[y][M].Rank),et.current=JSON.parse(JSON.stringify(T[y][M].standDetails)),ei(!0))},[T,y,M]),(0,s.useEffect)(()=>{ec(!1)},[a,k,e]);let em=(0,s.useCallback)(e=>{let a=W(e),r=null;a&&!Array.isArray(a)&&"userID"in a&&(r=a),r&&(L([...r.dataArr]),D(0),A(r.limit),R.current=r.limit,B(3),ec(!1),G("資料顯示完畢","success"),requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}))},[W()]),eh=(0,s.useCallback)(async e=>{U("正在更新資料中");let a=W(e),r=null;if(a&&!Array.isArray(a)&&"userID"in a&&(r=a),r){var t;let a={uid:r.userID,charID:r.char.charId,partsIndex:6},s=(null==(t=r.dataArr[0][3])?void 0:t.standDetails)?r.dataArr[0][3].standDetails.map(e=>({...e})):[];A(r.limit),await eo({sendData:a,standard:s,sendlimit:r.limit}).then(()=>{if(console.log(q.current),q.current){let a,t=0,s=0;q.current.forEach(e=>{for(var a=3;a<=4;a++)t+=Number(e[a].Rscore),s+=e[a].ExpRate});let l=Math.round(t/(2*q.current.length)*10)/10,i=new Date,n=Number((100*s/(2*q.current.length)).toFixed(1));ed.forEach(e=>{e.stand<=l&&void 0===a&&(a=e)});let c={version:"1.5",calDate:i.toISOString().split("T")[0],userID:r.userID,char:r.char,dataArr:q.current,avgScore:l,avgRank:a,avgRate:n,limit:R.current},d=JSON.parse(JSON.stringify(W()));d[e]=c,localStorage.setItem(z,JSON.stringify(d)),Q(d),G("已更新","success"),ec(!1)}}).catch(e=>{console.error("錯誤發生：",e),console.error("錯誤訊息：",e.message),console.error("堆疊追蹤：",e.stack)})}},[W()]),eu=(0,s.useCallback)(e=>{let a=W(),r=Array.isArray(a)?a.filter(e=>"userID"in e):[];Z(e),r=r.filter((a,r)=>r!==e),localStorage.setItem(z,JSON.stringify(r)),setTimeout(()=>{G("成功刪除該筆資料","success")},0)},[W()]),ef={charID:a,selfStand:ea,partsIndex:6,standDetails:et.current,partArr:["生之花","死之羽","時之沙","空之杯","理之冠"],isChangeAble:el,RelicDataArr:T,relicIndex:y,isLoad:X,limit:R.current,mode:"Importer",button:!0,relic:I,Rscore:H,Rrank:P,ExpRate:C,PieNums:J,AffixCount:M,deleteHistoryData:eu,checkDetails:em,updateDetails:eh,setCharID:b,setSelfStand:er,setIsSaveAble:ec,setRelicIndex:D,setRelic:S};return(0,t.jsxs)(p.A.Provider,{value:ef,children:[(0,t.jsxs)("div",{className:"flex flex-col w-4/5 mx-auto max-[600px]:w-[95%] rounded-md ",children:[(0,t.jsx)("div",{className:"rounded-md",children:(0,t.jsxs)("div",{className:"flex flex-row flex-wrap max-[600px]:w-[95%] ",children:[(0,t.jsxs)("div",{className:"flex flex-col w-2/5 bg-[rgba(0,0,0,0.5)] rounded-md max-[1250px]:w-[100%] test",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center ml-2 mt-2",children:[(0,t.jsx)("h1",{className:"text-red-600 font-bold text-2xl",children:"聖遺物重洗匯入"}),(0,t.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"ImporterHint",children:(0,t.jsx)("span",{className:"text-white",children:"?"})})]}),(0,t.jsxs)("div",{className:"flex flex-col px-2 rounded-md",children:[(0,t.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 items-baseline max-[400px]:!flex-col",children:[(0,t.jsx)("div",{className:"ImporterFlex",children:(0,t.jsx)("span",{className:"text-white",children:"玩家UID :"})}),(0,t.jsx)("input",{type:"text",placeholder:"Genshin UID",className:"h-[40px] max-w-[170px] pl-2    bg-inherit text-white outline-none border-b border-white",id:"userId",onChange:a=>e.current=a.target.value,disabled:!el,autoComplete:"off"})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center [&>*]:mr-2 my-3 max-[400px]:!flex-col",children:[(0,t.jsx)("div",{className:"ImporterFlex",children:(0,t.jsx)("span",{className:"text-white whitespace-nowrap",children:"Characters 腳色:"})}),(0,t.jsxs)("div",{className:"flex flex-row items-center",children:[(0,t.jsx)(f.zj,{}),(0,t.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"CharHint",children:(0,t.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,t.jsxs)("div",{className:"mt-4 [&>*]:mr-2 flex flex-row items-baseline max-[400px]:!flex-col",children:[(0,t.jsx)("div",{className:"ImporterFlex",children:(0,t.jsx)("span",{className:"text-white whitespace-nowrap",children:"Affix 有效詞條:"})}),(0,t.jsx)("div",{className:"flex flex-row items-center",children:(0,t.jsx)(f.mM,{})})]}),(0,t.jsxs)("div",{className:"mt-2 [&>*]:mr-2 flex flex-row max-[400px]:!flex-col ".concat(0===ea.length?"hidden":""),children:[(0,t.jsx)("div",{className:"ImporterFlex",children:(0,t.jsx)("span",{className:"text-white",children:"Params 參數:"})}),(0,t.jsxs)("div",{className:"flex flex-row items-baseline",children:[(0,t.jsx)(h.Q,{lock:!0}),(0,t.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"ParamsHint",children:(0,t.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,t.jsxs)("div",{className:"flex flex-row my-3",children:[(0,t.jsx)("div",{className:"ImporterFlex",children:(0,t.jsx)("span",{className:"text-white",children:"Limit 保底次數:"})}),(0,t.jsxs)("div",{className:"pl-1 flex flex-row items-center",children:[(0,t.jsx)("input",{type:"number",inputMode:"numeric",pattern:"\\d*",className:"bgInput w-[40px] text-center",defaultValue:2,onChange:e=>{let a=e.target.value;if(""!==a){let e=parseInt(a);isNaN(e)||A(e)}}}),(0,t.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"LimitHint",children:(0,t.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,t.jsxs)("div",{className:"my-3 flex flex-row [&>*]:mr-2 justify-end max-w-[400px] max-[900px]:justify-center",children:[(0,t.jsx)("button",{className:"processBtn",onClick:()=>eo({}),disabled:!el,children:"開始匹配"}),(0,t.jsx)("button",{className:"processBtn",onClick:()=>(function(){let r,t=l.A.find(e=>e.charId===a),s=K();if(Array.isArray(s)&&s.filter(e=>"userID"in e),0===T.length)return void G("當前沒有任何數據，不予儲存!!","error");if(!e.current)return void G("沒有輸入玩家ID，請再試一次!!","error");if(!a)return void G("沒有選擇任何腳色!!","error");if(k>4||k<2)return void G("保底次數有誤!!","error");let i=0,n=0,c=[...T];(c=c.filter(e=>{for(var a=3;a<=4;a++)if(null===e[a].ExpRate||null===e[a].PieNums)return!1;return!0})).forEach(e=>{for(var a=3;a<=4;a++)i+=Number(e[a].Rscore),n+=e[a].ExpRate});let d=Math.round(i/(2*c.length)*10)/10,o=new Date,x=Number((100*n/(2*c.length)).toFixed(1));ed.forEach(e=>{e.stand<=d&&void 0===r&&(r=e)});let m={version:"1.5",calDate:o.toISOString().split("T")[0],userID:e.current,char:t,dataArr:T,avgScore:d,avgRank:r,avgRate:x,limit:R.current},h=JSON.parse(JSON.stringify(W()));Y(m),h.push(m),G("已儲存","success"),ec(!1),localStorage.setItem(z,JSON.stringify(h))})(),disabled:!en,children:"儲存紀錄"})]})]})]}),(0,t.jsxs)("div",{className:"w-[55%] pb-3 pt-1 h-fit flex-wrap max-[1250px]:w-[100%] max-[1250px]:mb-5 ml-2 bg-[rgba(0,0,0,0.5)] rounded-md max-[1250px]:ml-0 max-[1250px]:mt-2",children:[(0,t.jsxs)("div",{className:"flex flex-row items-baseline px-2 max-[600px]:justify-center",children:[(0,t.jsx)("span",{className:"text-red-600 text-lg font-bold",children:"過往紀錄"}),(0,t.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"HistoryHint",children:(0,t.jsx)("span",{className:"text-white",children:"?"})})]}),(0,t.jsx)("div",{className:"max-h-[300px] overflow-y-scroll p-2  hiddenScrollBar flex flex-row flex-wrap max-[600px]:!flex-col max-[600px]:!flex-nowrap max-[600px]:items-center",children:(0,t.jsx)(x.f,{})})]})]})}),(0,t.jsxs)("div",{className:"flex flex-row flex-wrap mt-2 w-[100%] ".concat(T&&0!==T.length?"":"hidden"," bg-[rgba(0,0,0,0.5)] shadowBox px-2 mb-5 rounded-md"),children:[(0,t.jsx)("div",{className:"w-[100%] ".concat(void 0===T?"hidden":""," max-[500px]:justify-center"),children:(0,t.jsx)(f.aY,{})}),(0,t.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/4  max-[700px]:w-[50%] ".concat(I?"":"hidden"," max-[500px]:w-4/5 max-[500px]:mx-auto"),children:(0,t.jsx)(u.G,{})}),(0,t.jsx)("div",{className:"mt-3 w-1/4 max-[700px]:w-[50%] ".concat(et.current?"":"hidden"," max-[500px]:w-4/5 max-[500px]:mx-auto"),children:(0,t.jsx)(h.V,{})}),(0,t.jsxs)("div",{className:"mt-3 flex flex-col flex-wrap w-1/2 max-[700px]:w-[100%] ".concat(H?"":"hidden"," max-[500px]:w-4/5 max-[500px]:mx-auto"),id:"resultDetails",children:[J?(0,t.jsxs)("div",{className:"flex flex-row items-center",children:[(0,t.jsx)("button",{className:"underline cursor-pointer",onClick:()=>void(3===M?B(4):4===M&&B(3)),children:3===M?"目前為3詞條":"目前為4詞條"}),(0,t.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"AffixCountChangeHint",children:(0,t.jsx)("span",{className:"text-white",children:"?"})})]}):null,(0,t.jsx)(m.A,{})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.m_,{id:"CharHint",place:"right-start",render:()=>(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-white",children:"選擇指定腳色，可以使用中文或英文關鍵字"}),(0,t.jsx)("span",{className:"text-white",children:"例如:Jingliu→鏡流"})]})}),(0,t.jsx)(d.m_,{id:"HistoryHint",place:"top-start",render:()=>(0,t.jsx)(w.A,{})}),(0,t.jsx)(d.m_,{id:"RelicSelectHint",place:"top-start",render:()=>(0,t.jsxs)("div",{className:"flex flex-col [&>span]:text-white max-w-[250px] p-1",children:[(0,t.jsx)("span",{children:"下方會顯示出該腳色符合條件的所有遺器"}),(0,t.jsx)("span",{children:"點選遺器即可查看個別資訊"}),(0,t.jsxs)("div",{className:"mt-2 flex flex-col",children:[(0,t.jsx)("span",{className:"text-white font-bold",children:"注意事項"}),(0,t.jsx)("span",{className:"!text-red-600 font-bold",children:"僅顯示符合條件的五星滿等遺器遺器"})]})]})}),(0,t.jsx)(d.m_,{id:"ImporterHint",place:"right-start",render:()=>(0,t.jsx)(N,{}),clickable:!0}),(0,t.jsx)(d.m_,{id:"ParamsHint",place:"right-start",render:()=>(0,t.jsx)(g.A,{}),clickable:!0}),(0,t.jsx)(d.m_,{id:"LimitHint",place:"right-start",render:()=>(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:"指定詞條強化保底次數，可以根據個人目前使用強化情況調整"}),(0,t.jsx)("span",{children:"指定詞條們的共享保底次數，最低為2、最高為4"})]}),clickable:!0}),(0,t.jsx)(d.m_,{id:"AffixCountChangeHint",place:"right-start",render:()=>(0,t.jsxs)("div",{className:"max-w-[300px]",children:[(0,t.jsx)("div",{children:(0,t.jsx)("span",{children:"此按鈕可以切換該聖遺物至3詞條或4詞條模式"})}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("span",{className:"text-yellow-400",children:"目前API無法提供該聖遺物屬於初始3或4詞條，才會設計切換按鈕。"})})]})})]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[30,935,212,764,339,464,162,156,441,684,358],()=>a(112)),_N_E=e.O()}]);