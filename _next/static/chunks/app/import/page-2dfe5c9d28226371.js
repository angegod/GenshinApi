(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{112:(e,r,a)=>{Promise.resolve().then(a.bind(a,6740))},6740:(e,r,a)=>{"use strict";a.d(r,{default:()=>I});var s=a(5155),t=a(2115),l=a(8326),i=a(2039),n=a(3142);a(1209);var c=a(3464),o=a(5424),d=a(5695),x=a(1296),m=a(6719),u=a(5736),h=a(2224),f=a(2197),p=a(9779),v=a(4422),j=a(9194),w=a(4167);let N=function(){return(0,s.jsxs)("div",{className:"w-[300px] flex flex-col max-[600px]:my-3",children:[(0,s.jsx)("h2",{className:"text-red-600 font-bold text-lg",children:"使用說明"}),(0,s.jsxs)("ul",{className:"[&>li]:text-stone-400 list-decimal [&>li]:ml-2 max-[400px]:[&>li]:text-sm",children:[(0,s.jsx)("li",{children:"此工具會根據玩家放在展示框的12個腳色身上的聖遺物做數據分析"}),(0,s.jsx)("li",{children:"翻盤機率是指該聖遺物透過啟聖之塵後分數變高的機率為何"}),(0,s.jsx)("li",{children:"目前該工具只支援計算五星強化至滿等聖遺物"}),(0,s.jsx)("li",{children:"此工具相關數據或算法仍有更改的可能，敬請見諒!"}),(0,s.jsx)("li",{children:"如果發現服務頻繁發生錯誤，可以先暫時使用simulator"}),(0,s.jsx)("li",{children:"本工具數據來源於enka所開發出的API"}),(0,s.jsxs)("li",{children:["更詳細的操作說明可以參考",(0,s.jsx)("a",{href:"https://home.gamer.com.tw/artwork.php?sn=6191675",className:"!underline",children:"這篇"})]})]})]})};var g=a(5523),b=a(4585),S=a(3789);let I=function(){let e=(0,t.useRef)(""),[r,I]=(0,t.useState)(void 0),[y,A]=(0,t.useState)(),[k,D]=(0,t.useState)(0),[C,R]=(0,t.useState)(2),E=(0,t.useRef)(2),[H,P]=(0,t.useState)(void 0),[O,_]=(0,t.useState)(void 0),[J,T]=(0,t.useState)({label:void 0,tag:void 0,color:void 0,value:void 0}),[F,B]=(0,t.useState)(void 0),[M,W]=(0,t.useState)(3),[L,q]=(0,t.useState)([]),G=(0,t.useRef)(null),{showStatus:U,updateStatus:V,hideStatus:Y}=(0,v.Z)(),z="GenshinImporterData",{setHistory:Q,getHistory:Z,addHistory:$,deleteHistory:K,resetHistory:X,limitHistory:ee}=(0,j.A)(),[er,ea]=(0,t.useState)(!1),es=(0,b.A)(e=>e.openWindow),[et,el]=(0,t.useState)([]),ei=(0,t.useRef)([]),en=(0,d.usePathname)(),[ec,eo]=(0,t.useState)(!0),[ed,ex]=(0,t.useState)(!1),em=[{rank:"S+",stand:85,color:"rgb(239, 68, 68)",tag:"S+"},{rank:"S",stand:70,color:"rgb(239, 68, 68)",tag:"S"},{rank:"A",stand:50,color:"rgb(234, 179, 8)",tag:"A"},{rank:"B",stand:35,color:"rgb(234, 88 , 12)",tag:"B"},{rank:"C",stand:15,color:"rgb(163, 230, 53)",tag:"C"},{rank:"D",stand:0,color:"rgb(22,163,74)",tag:"D"}];async function eu(a){let{sendData:s,standard:t,sendlimit:l}=a,i="http://localhost:3000"===window.location.origin?"http://localhost:5000/artifact/get":"https://expressapi-o9du.onrender.com/artifact/get",n=0;if(!s){if(!/^\d+$/.test(e.current)||!e.current)return void V("請輸入有效的UID!!","error");if(!r)return void V("未選擇任何腳色!!","error");if(!et||0===et.length)return void V("至少選擇一項加權!!","error");if(et.filter(e=>{var r;return(null!=(r=e.SelectPriority)?r:0)>0}).length<2)return void V("優先指定詞條至少需要兩個!","error");if(C>4||C<2)return void V("保底次數只能為2,3或4次!","error");s={uid:e.current,charID:r}}t||(t=[...null!=et?et:[]]),n=l||C,ex(!1),U("正在尋找匹配資料......","process"),eo(!1),P(void 0),T({label:void 0,tag:void 0,color:void 0,value:void 0}),B(void 0),_(void 0),q([]),A(void 0),await c.A.post(i,s,{headers:{"Content-Type":"application/json"}}).then(async e=>{switch(e.data){case 800:V("找不到該腳色。必須要將腳色放在展示區才可以抓到資料!!","error"),eo(!0);break;case 801:V("找不到該部件的聖遺物，如果是剛剛才更新的話建議等五分鐘再使用一次!!","error"),eo(!0);break;case 802:V("該聖遺物等級尚未強化至滿等，請先強化至滿等後再嘗試!","error"),eo(!0);break;case 803:V("該聖遺物非五星聖遺物，請選擇部位為五星強化滿等之聖遺物","error"),eo(!0);break;case 804:V("該腳色並未穿著五星聖遺物！！","error"),eo(!0);break;case 810:V("溝通次數太過於頻繁 請稍後再試!!","error"),eo(!0);break;case 900:V("系統正在維護\n請稍後再試!","error"),eo(!0);break;default:await eh(e.data,t,n)}}).catch(e=>{e.response&&429===e.response.status?V("請求次數過於頻繁\n請稍後再試!!","error"):V("系統正在維護中\n請稍後再試!!","error"),eo(!0)})}async function eh(e,s,t){let l=[];for(let o of e){let e={};for(var c=3;c<=4;c++){let l=await function(e,s,t,l){return new Promise(c=>{let o=new Worker(a.tu(new URL(a.p+a.u(682),a.b))),d=i.A.find(r=>r.fieldName===e.flat.reliquaryMainstat.mainPropId),x=[];e.flat.reliquarySubstats.forEach((e,r)=>{let a=i.A.find(r=>r.fieldName===e.appendPropId),s=e.statValue,t={index:r,subaffix:a.name,data:s};x.push(t)});let m={charID:r,MainData:d.name,SubData:x,partsIndex:n.A[e.flat.equipType],standard:s,limit:l,enchanceCount:t};U("數據計算處理中......","process"),o.postMessage(m),o.onmessage=function(r){c({relic:e,ExpRate:r.data.expRate,Rscore:r.data.relicscore,PieNums:r.data.returnData,Rank:r.data.relicrank,standDetails:s})}})}(o,s,c+1,t);e[c]=l}l.push(e)}0===l.length?(V("該腳色身上的聖遺物不符合重洗條件!!","default"),eo(!0)):V("資料顯示完畢","success"),q(l),G.current=l,E.current=t,ex(!0)}(0,t.useEffect)(()=>{!function(){ea(!1),R(2),X();let e=localStorage.getItem(z),r=e?JSON.parse(e):null;if(console.log(r),null===r){Q([]),ea(!0),V("尚未有任何操作紀錄","default");return}U("正在載入過往紀錄中......","process"),r=r.filter(e=>"1.5"===e.version),localStorage.setItem(z,JSON.stringify(r)),null!=r&&r.length>0?(Q(r),V("先前紀錄已匯入!!","success")):V("尚未有任何操作紀錄","default"),ea(!0)}()},[en]),(0,t.useEffect)(()=>{0!==L.length&&(A(L[k][M].relic),P(L[k][M].ExpRate),_(L[k][M].Rscore),B(L[k][M].PieNums),T(L[k][M].Rank),ei.current=JSON.parse(JSON.stringify(L[k][M].standDetails)),eo(!0))},[L,k,M]),(0,t.useEffect)(()=>{ex(!1)},[r,C,e]);let ef=(0,t.useCallback)(e=>{let r=Z(e),a=null;r&&!Array.isArray(r)&&"userID"in r&&(a=r),a&&(q([...a.dataArr]),D(0),R(a.limit),E.current=a.limit,W(3),ex(!1),V("資料顯示完畢","success"),requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}))},[Z()]),ep=(0,t.useCallback)(async e=>{U("正在更新資料中");let r=Z(e),a=null;if(r&&!Array.isArray(r)&&"userID"in r&&(a=r),a){var s;let r={uid:a.userID,charID:a.char.charId,partsIndex:6},t=(null==(s=a.dataArr[0][3])?void 0:s.standDetails)?a.dataArr[0][3].standDetails.map(e=>({...e})):[];R(a.limit),await eu({sendData:r,standard:t,sendlimit:a.limit}).then(()=>{if(console.log(G.current),G.current){let r,s=0,t=0;G.current.forEach(e=>{for(var r=3;r<=4;r++)s+=Number(e[r].Rscore),t+=e[r].ExpRate});let l=Math.round(s/(2*G.current.length)*10)/10,i=new Date,n=Number((100*t/(2*G.current.length)).toFixed(1));em.forEach(e=>{e.stand<=l&&void 0===r&&(r=e)});let c={version:"1.5",calDate:i.toISOString().split("T")[0],userID:a.userID,char:a.char,dataArr:G.current,avgScore:l,avgRank:r,avgRate:n,limit:E.current},o=JSON.parse(JSON.stringify(Z()));o[e]=c,localStorage.setItem(z,JSON.stringify(o)),Q(o),V("已更新","success"),ex(!1)}}).catch(e=>{console.error("錯誤發生：",e),console.error("錯誤訊息：",e.message),console.error("堆疊追蹤：",e.stack)})}},[Z()]),ev=(0,t.useCallback)(e=>{if(!confirm("確定要刪除紀錄嗎?"))return;let r=Z(),a=Array.isArray(r)?r.filter(e=>"userID"in e):[];K(e),a=a.filter((r,a)=>a!==e),localStorage.setItem(z,JSON.stringify(a)),setTimeout(()=>{V("成功刪除該筆資料","success")},0)},[Z()]),ej={charID:r,selfStand:et,partsIndex:6,standDetails:ei.current,partArr:["生之花","死之羽","時之沙","空之杯","理之冠"],isChangeAble:ec,RelicDataArr:L,relicIndex:k,isLoad:er,limit:E.current,mode:"Importer",button:!0,relic:y,Rscore:O,Rrank:J,ExpRate:H,PieNums:F,AffixCount:M,deleteHistoryData:ev,checkDetails:ef,updateDetails:ep,setCharID:I,setSelfStand:el,setIsSaveAble:ex,setRelicIndex:D,setRelic:A};return(0,s.jsxs)(p.A.Provider,{value:ej,children:[(0,s.jsxs)("div",{className:"flex flex-col w-4/5 mx-auto max-[600px]:w-[95%] rounded-md ",children:[(0,s.jsx)("div",{className:"rounded-md",children:(0,s.jsxs)("div",{className:"rowWrap max-[600px]:w-[95%]",children:[(0,s.jsxs)("div",{className:"flex flex-col w-2/5 SectionBg rounded-md max-[1250px]:w-full",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center ml-2 mt-2",children:[(0,s.jsx)("h1",{className:"text-red-600 font-bold text-2xl",children:"自動匯入"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"ImporterHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})}),(0,s.jsxs)("div",{className:"relative flex flex-row ml-auto mr-3",onClick:()=>es(),children:[(0,s.jsx)("img",{src:"".concat("/GenshinApi","/image/breakingNews.svg"),alt:"icon"}),(0,s.jsx)("span",{className:"text-white underline cursor-pointer",children:"最新更新"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col px-2 rounded-md",children:[(0,s.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"ImporterFlex",children:(0,s.jsx)("span",{className:"SubTitle",children:"玩家UID :"})}),(0,s.jsx)("input",{type:"text",placeholder:"Genshin UID",className:"h-[40px] max-w-[170px] pl-2    bg-inherit text-white outline-none border-b border-white",id:"userId",onChange:r=>e.current=r.target.value,disabled:!ec,autoComplete:"off"})]}),(0,s.jsxs)("div",{className:"flex flex-row items-center [&>*]:mr-2 my-3 max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"ImporterFlex",children:(0,s.jsx)("span",{className:"SubTitle whitespace-nowrap",children:"Characters 腳色:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)(f.zj,{}),(0,s.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"CharHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"mt-4 [&>*]:mr-2 flex flex-row items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"ImporterFlex",children:(0,s.jsx)("span",{className:"SubTitle whitespace-nowrap",children:"Affix 有效詞條:"})}),(0,s.jsx)("div",{className:"flex flex-row items-center",children:(0,s.jsx)(f.mM,{})})]}),et&&0!==et.length?(0,s.jsxs)("div",{className:"mt-3 [&>*]:mr-2 flex flex-row max-[400px]:!flex-col ".concat(0===et.length?"hidden":""),children:[(0,s.jsx)("div",{className:"ImporterFlex",children:(0,s.jsx)("span",{className:"SubTitle",children:"Params 參數:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-baseline",children:[(0,s.jsx)(u.Q,{lock:!0}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"ParamsHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}):null,(0,s.jsxs)("div",{className:"flex flex-row my-3",children:[(0,s.jsx)("div",{className:"ImporterFlex",children:(0,s.jsx)("span",{className:"SubTitle",children:"Limit 保底次數:"})}),(0,s.jsxs)("div",{className:"pl-1 flex flex-row items-center",children:[(0,s.jsx)("input",{type:"number",inputMode:"numeric",pattern:"\\d*",className:"bgInput w-[40px] text-center",defaultValue:2,onChange:e=>{let r=e.target.value;if(""!==r){let e=parseInt(r);isNaN(e)||R(e)}}}),(0,s.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"LimitHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"my-3 flex flex-row [&>*]:mr-2 justify-end max-w-[400px] max-[900px]:justify-center",children:[(0,s.jsx)(S.A,{text:"開始匹配",handler:()=>eu({}),disabled:!ec}),(0,s.jsx)(S.A,{text:"儲存紀錄",handler:()=>(function(){let a,s=l.A.find(e=>e.charId===r),t=ee();if(Array.isArray(t)&&t.filter(e=>"userID"in e),0===L.length)return void V("當前沒有任何數據，不予儲存!!","error");if(!e.current)return void V("沒有輸入玩家ID，請再試一次!!","error");if(!r)return void V("沒有選擇任何腳色!!","error");if(C>4||C<2)return void V("保底次數有誤!!","error");let i=0,n=0,c=[...L];(c=c.filter(e=>{for(var r=3;r<=4;r++)if(null===e[r].ExpRate||null===e[r].PieNums)return!1;return!0})).forEach(e=>{for(var r=3;r<=4;r++)i+=Number(e[r].Rscore),n+=e[r].ExpRate});let o=Math.round(i/(2*c.length)*10)/10,d=new Date,x=Number((100*n/(2*c.length)).toFixed(1));em.forEach(e=>{e.stand<=o&&void 0===a&&(a=e)});let m={version:"1.5",calDate:d.toISOString().split("T")[0],userID:e.current,char:s,dataArr:L,avgScore:o,avgRank:a,avgRate:x,limit:E.current},u=JSON.parse(JSON.stringify(Z()));$(m),u.push(m),V("已儲存","success"),ex(!1),localStorage.setItem(z,JSON.stringify(u))})(),disabled:!ed})]})]})]}),(0,s.jsxs)("div",{className:"w-[55%] pb-3 pt-1 h-fit flex-wrap max-[1250px]:w-full max-[1250px]:mb-5 ml-2 SectionBg rounded-md max-[1250px]:ml-0 max-[1250px]:mt-2",children:[(0,s.jsxs)("div",{className:"flex flex-row items-baseline px-2 max-[600px]:justify-center",children:[(0,s.jsx)("span",{className:"text-red-600 text-lg font-bold",children:"過往紀錄"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"HistoryHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]}),(0,s.jsx)("div",{className:"max-h-[300px] overflow-x-scroll grayScrollBar p-2 flex flex-row max-[600px]:items-center",children:(0,s.jsx)(x.f,{})})]})]})}),L&&L.length>0?(0,s.jsxs)("div",{className:"rowWrap mt-2 w-full SectionBg shadowBox px-2 mb-5 rounded-md",children:[(0,s.jsx)("div",{className:"w-1/2 max-[800px]:w-full max-[500px]:w-4/5 max-[500px]:mx-auto",children:(0,s.jsx)(f.aY,{})}),(0,s.jsx)("div",{className:"rowWrap w-1/2 max-[800px]:w-full max-[500px]:w-4/5 max-[500px]:mx-auto",children:(0,s.jsx)(h.G,{})}),(0,s.jsxs)("div",{className:"mt-3 rowWrap w-1/2 max-[700px]:items-center max-[700px]:w-full ".concat(O?"":"hidden"," max-[500px]:w-4/5 max-[500px]:mx-auto"),id:"resultDetails",children:[F?(0,s.jsxs)("div",{className:"flex flex-row items-center max-[700px]:mx-auto",children:[(0,s.jsx)("button",{className:"underline cursor-pointer",onClick:()=>void(3===M?W(4):4===M&&W(3)),children:3===M?"目前為3詞條":"目前為4詞條"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"AffixCountChangeHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]}):null,(0,s.jsx)(m.A,{})]})]}):null]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(o.m_,{id:"CharHint",place:"right-start",arrowColor:"gray",render:()=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-white",children:"選擇指定腳色，可以使用中文或英文關鍵字"}),(0,s.jsx)("span",{className:"text-white",children:"例如:霄宮→Yoimiya"})]})}),(0,s.jsx)(o.m_,{id:"HistoryHint",place:"top-start",arrowColor:"gray",render:()=>(0,s.jsx)(w.A,{})}),(0,s.jsx)(o.m_,{id:"RelicSelectHint",place:"top-start",arrowColor:"gray",render:()=>(0,s.jsxs)("div",{className:"flex flex-col [&>span]:text-white max-w-[250px] p-1",children:[(0,s.jsx)("span",{children:"下方會顯示出該腳色符合條件的所有聖遺物"}),(0,s.jsx)("span",{children:"點選聖遺物即可查看個別資訊"}),(0,s.jsxs)("div",{className:"mt-2 flex flex-col",children:[(0,s.jsx)("span",{className:"text-white font-bold",children:"注意事項"}),(0,s.jsx)("span",{className:"!text-red-600 font-bold",children:"僅顯示符合條件的五星滿等聖遺物"})]})]})}),(0,s.jsx)(o.m_,{id:"ImporterHint",place:"right-start",arrowColor:"gray",render:()=>(0,s.jsx)(N,{}),clickable:!0}),(0,s.jsx)(o.m_,{id:"ParamsHint",place:"right-start",arrowColor:"gray",render:()=>(0,s.jsx)(g.A,{}),clickable:!0}),(0,s.jsx)(o.m_,{id:"LimitHint",place:"right-start",arrowColor:"gray",render:()=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:"指定詞條強化保底次數，可以根據個人目前使用強化情況調整"}),(0,s.jsx)("span",{children:"指定詞條們的共享保底次數，最低為2、最高為4"})]}),clickable:!0}),(0,s.jsx)(o.m_,{id:"AffixCountChangeHint",place:"right-start",arrowColor:"gray",render:()=>(0,s.jsxs)("div",{className:"max-w-[300px]",children:[(0,s.jsx)("div",{children:(0,s.jsx)("span",{children:"此按鈕可以切換該聖遺物至3詞條或4詞條模式"})}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("span",{className:"text-yellow-400",children:"目前API無法提供該聖遺物屬於初始3或4詞條，才會設計切換按鈕。"})})]})})]})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[30,375,224,704,874,339,464,687,907,441,684,358],()=>r(112)),_N_E=e.O()}]);